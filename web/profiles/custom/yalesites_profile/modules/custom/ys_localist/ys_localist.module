<?php

/**
 * @file
 * Primary module hooks for YS Localist module.
 */

use Drupal\migrate\Plugin\MigrationInterface;

/**
 * Returns dynamic URLs for Localist migrations.
 *
 * @see migrations/localist_events.yml
 */
function ys_localist_migrate_url(MigrationInterface $migration) {
  // Gets the latest version from the API by changing the request URL each time.
  $version = time();

  // @todo Eventually many of these values will come from a settings page.
  $baseURL = "https://yale.enterprise.localist.com/api/2/events";

  // Currently testing the Yale Health group.
  $groupId = 45811180571509;

  // Localist supports only getting 365 days from today.
  $endDate = date('Y-m-d', strtotime("+364 days"));

  /* @todo - `pp=` fetches 100 date instances (the max that Localist  supports).
   * This endpoint does support paging, eventually we need to support that here
   * as well. Migrate Plus has a patch that isn't currently applying:
   * https://www.drupal.org/project/migrate_plus/issues/2640516
   * */
  $endPointWithParams = "$baseURL?end=$endDate&group_id=$groupId&v=$version&pp=100";

  return [$endPointWithParams];
}
