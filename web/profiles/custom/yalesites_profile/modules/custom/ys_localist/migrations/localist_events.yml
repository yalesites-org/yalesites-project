id: localist_events
label: 'Localist events'
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json
  urls:
    # @see ys_localist.module
    callback: ys_localist_migrate_url
  item_selector: events
  fields:
    -
      name: event_instance_id
      label: 'Event Instance ID'
      selector: event/event_instances/0/event_instance/id
    -
      name: localist_title
      label: 'Localist title'
      selector: event/title
    -
      name: start_date
      label: 'Start date'
      selector: event/event_instances/0/event_instance/start
    -
      name: end_date
      label: 'End date'
      selector: event/event_instances/0/event_instance/end

  ids:
    event_instance_id:
      # This would be an int, but it is too long for the DB
      type: string
  constants:
    timezone: America/New_York
process:
  title: localist_title
  field_localist_id: event_instance_id
  field_event_date/value:
      plugin: callback
      callable: strtotime
      source: start_date
  field_event_date/end_value:
    -
      plugin: null_coalesce
      source:
        - end_date
        - start_date
    -
      plugin: callback
      callable: strtotime
  field_event_date/timezone: constants/timezone
  field_event_date/duration:
      plugin: get_date_duration
      source: end_date
      values:
        - start_date

destination:
  plugin: 'entity:node'
  default_bundle: event
# migration_dependencies:
#   required:
#     - localist_event_types
#   optional: []
