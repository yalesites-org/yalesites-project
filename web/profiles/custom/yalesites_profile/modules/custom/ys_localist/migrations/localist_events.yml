id: localist_events
label: 'Localist events'
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: localist_json
  track_changes: true
  urls:
    # @see ys_localist.module
    callback: ys_localist_migrate_url
  item_selector: events
  fields:
    -
      name: event_id
      label: 'Event ID'
      selector: localist_data/id
    -
      name: localist_title
      label: 'Localist title'
      selector: localist_data/title
    -
      name: localist_description
      label: 'Localist description'
      selector: localist_data/description
    -
      name: localist_room
      label: 'Localist room'
      selector: localist_data/room_number
    -
      name: localist_image_url
      label: 'Localist image URL'
      selector: localist_data/photo_url
    -
      name: localist_event_url
      label: 'Localist event URL'
      selector: localist_data/localist_url
    -
      name: localist_ics_url
      label: ICS URL
      selector: localist_data/localist_ics_url
    -
      name: event_instances
      label: 'Event instance'
      selector: instances
    -
      name: recurring
      label: Recurring
      selector: localist_data/recurring
    -
      name: experience
      label: Experience
      selector: localist_data/experience
    -
      name: place_name
      label: Place name
      selector: localist_data/location_name

  ids:
    event_id:
      # This would be an int, but it is too long for the DB
      type: string
process:
  title: localist_title
  field_localist_id: event_id
  field_event_description/value: localist_description
  field_event_description/format:
    plugin: default_value
    default_value: basic_html
  field_event_room: localist_room
  field_localist_event_url/uri: localist_event_url
  field_localist_event_image_url/uri: localist_image_url
  field_localist_ics_url/uri: localist_ics_url
  field_event_date: event_instances
  field_event_recurring: recurring
  field_event_type:
    plugin: migration_lookup
    migration: localist_experiences
    source: experience
  field_event_place:
    plugin: entity_lookup
    source: place_name
    value_key: name
    bundle_key: vid
    bundle: event_place
    entity_type: taxonomy_term

destination:
  plugin: 'entity:node'
  default_bundle: event
  overwrite_properties:
    - field_localist_description
    - field_event_date
    - field_event_type
migration_dependencies:
  required:
    - localist_experiences
    - localist_places
  optional: []
