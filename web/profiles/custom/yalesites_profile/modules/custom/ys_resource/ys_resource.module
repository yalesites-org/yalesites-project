<?php

/**
 * @file
 * Implement various hooks and functionality.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_preprocess_views_view().
 */
function ys_resource_preprocess_views_view(array &$variables) {
  // Check the specific view and display you want to target.
  if ($variables['view']->id() == 'resource_tags_overview' && $variables['view']->current_display == 'page_1') {
    $config = \Drupal::config('ys_resource.resource_config');
    // Pass the variable to the Twig template.
    $variables['all_resources_link'] = $config->get('resource_full_page_link');
  }
}

/**
 * Implements hook_form_alter().
 */
function ys_resource_form_alter(&$form, FormStateInterface &$form_state, $form_id) {
  // Get resource Config values.
  $resource_config = \Drupal::config('ys_resource.resource_config');
  $category_parent = $resource_config->get('category_parent_term');
  // Limit category terms in resource search exposed form.
  if ($form_id == 'views_exposed_form' && $form['#id'] == 'views-exposed-form-explore-resources-block-1') {
    $category_childs = [];
    $cat_terms = \Drupal::service("entity_type.manager")->getStorage("taxonomy_term")->loadTree("page_category", $category_parent, 1, TRUE);
    foreach ($cat_terms as $term) {
      $category_childs[$term->id()] = $term->label();
    }
    $form['field_category_target_id']['#options'] = $category_childs;
  }
}
