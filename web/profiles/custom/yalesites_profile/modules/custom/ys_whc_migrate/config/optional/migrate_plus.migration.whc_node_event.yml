langcode: en
status: true
id: whc_node_event
label: 'Whitney Events'
migration_group: ys_whc_migrate
migration_tags:
  - whc_node
source:
  plugin: whc_node
  node_type: event
process:
  langcode: constants/langcode_en
  status: status
  created: created
  changed: changed
  title:
    - plugin: if_condition
      condition: empty
      source: field_lecturer/0/value
      do_get: title
      else_process:
        plugin: concat
        source:
          - field_lecturer/0/value
          - title
        delimiter: ' | '
    - plugin: callback
      callable: strip_tags
    - plugin: callback
      callable: '\Drupal\ys_whc_migrate\Plugin\migrate\process\ContentToLayoutBuilder::replaceStraightQuotes'
  field_teaser_media/0/target_id:
    plugin: migration_lookup
    migration: whc_node_images
    source: field_event_image/0/fid
    no_stub: true
  field_event_date/0: field_event_time/0/smart_date
  field_event_description/0/value:
    - plugin: skip_on_value
      source: field_series/0/target_id
      not_equals: true
      value:
        - 3  # Shulman Lectures in Science and the Humanities
        - 14 # Franke Visiting Fellows
        - 15 # Finzi-Contini Lectures
        - 16 # Franke Lectures in the Humanities
        - 17 # Tanner Lectures on Human Values
        - 32 # Films at the Whitney
        - 48 # Whitney Publishing Project
        - 56 # Humanities Now
      method: process
    - plugin: get
      source: body/0/value
  field_event_description/0/format:
    plugin: default_value
    default_value: basic_html
  field_tags:
    plugin: migration_lookup
    migration: whc_taxonomy_series
    source: field_series/0/target_id
    no_stub: true
  _tag_name:
    - plugin: skip_on_value
      source: field_series/0/target_id
      not_equals: true
      value:
        - 14 # Franke Visiting Fellows
        - 15 # Finzi-Contini Lectures
        - 16 # Franke Lectures in the Humanities
        - 17 # Tanner Lectures on Human Values
        - 32 # Films at the Whitney
        - 48 # Whitney Publishing Project
        - 56 # Humanities Now
      method: process
    - plugin: get
      source: '@field_tags'
    - plugin: callback
      callable: '\Drupal\ys_whc_migrate\Plugin\migrate\process\ContentToLayoutBuilder::getTermName'
  layout_builder__layout:
    plugin: whc_content_to_layout_builder
    default_section_type: event
    sections:
      body:
        id: layout_onecol
        components:
          - type: text
            source: '@_tag_name'
            wrap_value: true
  path/alias:
    -
      plugin: concat
      source:
        - constants/slash
        - alias
  path/pathauto:
    plugin: null_coalesce
    source:
      - pathauto
      - constants/one
  moderation_state:
    plugin: static_map
    source: status
    default_value: draft
    map:
      0: draft
      1: published
destination:
  plugin: entity:node
  default_bundle: event
migration_dependencies:
  required:
    - whc_node_images
    - whc_taxonomy_series
    - whc_focal_point
  optional: [  ]

dependencies:
  enforced:
    module:
      - ys_whc_migrate
