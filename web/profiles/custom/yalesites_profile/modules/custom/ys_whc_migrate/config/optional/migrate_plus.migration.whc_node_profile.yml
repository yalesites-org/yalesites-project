langcode: en
status: true
id: whc_node_profile
label: 'Whitney Profiles'
migration_group: ys_whc_migrate
migration_tags:
  - whc_node
source:
  plugin: whc_user
process:
  langcode: constants/langcode_en
  status: status
  created: created
  changed: changed
  field_first_name:
    plugin: skip_on_empty
    method: row
    source: field_firstname/0/value
  field_last_name: field_lastname
  title:
    plugin: concat
    source:
      - field_firstname/0/value
      - field_lastname/0/value
    delimiter: ' '
  field_position: field_title
  field_department:
    plugin: if_condition
    source: field_fellow_role/0/target_id
    condition:
      plugin: in_array
      value:
        - 61 # 2024–25 GPE Fellows
        - 57 # 2023–24 GPE Fellows
        - 50 # 2022–23 GPE Fellows
        - 60 # 2024–25 Environmental Humanities Graduate Fellows
        - 49 # 2023–24 Environmental Humanities Graduate Fellows
        - 47 # 2022–23 Environmental Humanities Graduate Fellows
        - 44 # 2021–22 Environmental Humanities Graduate Fellows
    do_get: field_title/0/value
    else_get: field_department/0/value
  field_affiliation:
    plugin: entity_generate
    source: field_people_type/0/value
    entity_type: taxonomy_term
    bundle: affiliation
    bundle_key: vid
    value_key: name
    ignore_case: true
  field_teaser_media/0/target_id:
    plugin: migration_lookup
    migration: whc_user_media
    source: uid
    no_stub: true
  field_audience:
    plugin: migration_lookup
    migration: whc_taxonomy_fellow_role
    source: field_series/0/target_id
    no_stub: true
  layout_builder__layout:
    plugin: whc_content_to_layout_builder
    default_section_type: profile
    sections:
      body:
        id: layout_onecol
        components:
          - type: text
            source: field_bio/0/value
  path/pathauto:
    plugin: null_coalesce
    source:
      - pathauto
      - constants/one
  moderation_state:
    plugin: static_map
    source: status
    default_value: draft
    map:
      0: draft
      1: published
destination:
  plugin: entity:node
  default_bundle: profile
migration_dependencies:
  required:
    - whc_user_media
    - whc_taxonomy_fellow_role
  optional: [  ]

dependencies:
  enforced:
    module:
      - ys_whc_migrate
