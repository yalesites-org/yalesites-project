langcode: en
status: true
id: whc_node_video
label: 'Whitney Node Videos'
migration_group: ys_whc_migrate
migration_tags:
  - whc_node
source:
  plugin: whc_node
  node_type: video
  constants:
    quotation_mark: '"'
process:
  langcode: constants/langcode_en
  status: status
  created: created
  changed: changed
  title:
    plugin: callback
    callable: trim
    unpack_source: true
    source:
      - title
      - constants/quotation_mark
  field_author: field_lecturer
  field_publish_date: field_date
  field_category/0/target_id:
    - plugin: default_value
      default_value: 'Video'
    - plugin: entity_generate
      entity_type: taxonomy_term
      bundle: post_category
      bundle_key: vid
      value_key: name
      ignore_case: true
  field_tags:
    plugin: migration_lookup
    migration: whc_taxonomy_series
    source: field_series/0/target_id
    no_stub: true
  _video:
    - plugin: skip_on_empty
      method: row
      source: field_video/0/video_url
    - plugin: callback
      callable: '\Drupal\ys_whc_migrate\Plugin\migrate\process\ContentToLayoutBuilder::toWatchUrl'
    - plugin: entity_generate
      entity_type: media
      bundle: video
      bundle_key: bundle
      value_key: field_media_oembed_video
      ignore_case: true
  layout_builder__layout:
    plugin: whc_content_to_layout_builder
    default_section_type: post
    sections:
      body:
        id: layout_onecol
        components:
          - type: video_banner
            source: '@_video'
          - type: text
            source: body/0/value
  path/alias:
    -
      plugin: concat
      source:
        - constants/slash
        - alias
  path/pathauto: constants/zero
  moderation_state:
    plugin: static_map
    source: status
    default_value: draft
    map:
      0: draft
      1: published
destination:
  plugin: entity:node
  default_bundle: post
migration_dependencies:
  required: [  ]
  optional: [  ]

dependencies:
  enforced:
    module:
      - ys_whc_migrate
