id: ys_test_layout_enhancement
label: 'Test Layout Enhancement - Add Blocks to Existing Pages'
migration_group: ys_field_tests

source:
  plugin: embedded_data
  data_rows:
    # Test data - add blocks to Homepage (node 113)
    - node_id: 113
      blocks_to_add:
        - type: text
          source: create
          data:
            field_text:
              value: '<p>This is a migrated text block added to the Homepage Content Section.</p>'
              format: 'basic_html'
            field_style_variation: 'default'
        - type: text
          source: create
          data:
            field_text:
              value: '<p>This is a second migrated block testing append functionality on Homepage.</p>'
              format: 'basic_html'
            field_style_variation: 'highlight'
  ids:
    node_id:
      type: integer

process:
  # Target node for layout enhancement
  target_node: node_id
  
  # Create blocks first (this would need to be a separate migration in practice)
  block_data: blocks_to_add
  
  # Use our enhanced ConfigurableLayoutBuilder to append to Content Section
  layout_builder__layout:
    plugin: configurable_layout_builder
    source: '@target_node'
    target_section: 'Content Section'
    append_mode: true
    sections:
      - layout: layout_onecol
        regions:
          content:
            - type: text
              source: create
              data: '@block_data/0/data'
            - type: text
              source: create
              data: '@block_data/1/data'

destination:
  plugin: 'entity:node'

migration_dependencies: {}